---
- name: Bootstrap system
  hosts: all
  roles:
    - zinit
  tasks:
    - name: Install Linuxbrew
      shell: curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh | bash -c
      args:
        creates: /home/linuxbrew/.linuxbrew

    - name: Install apt packages
      become: true
      ansible.builtin.apt:
        name:
          - zsh
        state: present

    - name: Install snap packages
      become: true
      community.general.snap:
        name:
          - discord
          - ghostty
          - spotify
          - steam
        state: present

    - name: Install brew packages
      community.general.homebrew:
        name:
          - charmbracelet/tap/crush
          - dagger/tap/dagger
          - dagger/tap/container-use
          - frantjc/tap/forge
          - frantjc/tap/rvglsm
          - gh
          - go
          - golangci-lint
          - goreleaser
          - k9s
          - kind
          - kuberctx
          - kubernetes-cli
          - node
          # TODO(frantjc): spotdl in ~/.local/bin
          - pipx
          - upx
          - yq
        state: present

    - name: Install flatpak packages
      community.general.flatpak:
        method: user
        name:
          - at.vintagestory.VintageStory
          - chat.revolt.RevoltDesktop
          - com.github.iwalton3.jellyfin-media-player
          - https://mickael9.github.io/rvgl-flatpak/rvgl.flatpakref
        state: present